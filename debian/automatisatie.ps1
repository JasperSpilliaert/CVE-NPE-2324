$vmnaam = "KaliOefeningen2023-2024"
$userChoice = Read-Host "Kies de gebruiker voor de VM setup (Kies '1' voor Jasper, '2' voor Quinten, '3' voor Jorik, '4' voor een custom path)"
switch ($userChoice) {
    "1" {
        $userName = "Jasper"
        $vmpath = "C:\Users\peter\OneDrive\Bureaublad\64bit(2)\64bit\Kali Linux 2023.4 (64bit).vdi"
        $medium = "C:\Users\peter\VirtualBox VMs\$vmnaam\$vmnaam.vdi"
        $bridged_adapter_name = "Realtek RTL8822CE 802.11ac PCIe Adapter"
        $localPath = "C:\Users\peter\OneDrive\Bureaublad\HOGENT\2de\semester2\CyberVr\CSV-NPE-2324\debian\script2.sh"
    }
    "2" {
        $userName = "Quinten"
        $vmpath = "C:\Users\quint\OneDrive - Breugelmans\Bureaublad\School 2023-2024\Semester 2\Cybersecurity & Virtualisation\Ubuntu 22.04 (64bit).vdi"
        $medium = "C:\Users\quint\VirtualBox VMs\$vmnaam\$vmnaam.vdi"
        $bridged_adapter_name = "Intel(R) Wi-Fi 6E AX210 160MHz"
        $localPath = "C:\Users\quint\OneDrive - Breugelmans\Bureaublad\School 2023-2024\Semester 2\Cybersecurity & Virtualisation\CSV-NPE-2324\debian\script2.sh"
    }
    "3" {
        $userName = "Jorik"
        $vmpath = "C:\HoGent\2deJaar\cybersecv\git\Ubuntu 22.04 (64bit).vdi"
        $medium = "C:\Users\braet\VirtualBox VMs\$vmnaam\$vmnaam.vdi"
        $bridged_adapter_name = "Realtek Gaming GbE Family Controller"
        $localPath = "C:\HoGent\2deJaar\cybersecv\git\CSV-NPE-2324\debian\script2.sh"
    }
    "4" {
        $userName = "Custom User"
        $vmpath = Read-Host "Geef het volledige pad naar je Ubuntu 22.04 VDI file"
        $medium = Read-Host "Geef het volledige pad naar je virtuele hard disk (f.e. C:\Users\peter\VirtualBox VMs\$vmnaam\$vmnaam.vdi)"
        $bridged_adapter_name = Read-Host "Geef de naam van je Bridged Adapter"
        $localPath =Read-Host "Geef de naam van het pad naar de script2.sh file"
    }
    default {
        Write-Host "Ongeldige selectie, exiting..."
        exit
    }
}
$ostype = "Ubuntu_64"
$mem = 2048
$vram = 128
$cpus = 2
$drivesize1 = 20480
$netwerkadapter1 = "bridged"
$controller = "IntelAHCI"

if (!(Test-Path $vmpath)) {
    Write-Host "$vmpath niet gevonden. Controleer het pad naar het VDI-bestand."
    return
}

# Maak de VM aan in VirtualBox
vboxmanage createvm --name "$vmnaam" --ostype $ostype --register

# Grafische controller instellen
vboxmanage modifyvm $vmnaam --graphicscontroller vmsvga

vboxmanage modifyvm $vmnaam --memory $mem --vram $vram --cpus $cpus
vboxmanage modifyvm $vmnaam --nic1 $netwerkadapter1 --bridgeadapter1 $bridged_adapter_name

vboxmanage createmedium --filename $medium --size $drivesize1

vboxmanage storagectl $vmnaam --name "SATA Controller" --add sata --controller $controller
vboxmanage storageattach $vmnaam --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium $vmpath
vboxmanage storageattach $vmnaam --storagectl "SATA Controller" --port 1 --device 0 --type dvddrive --medium "C:\Program Files\Oracle\VirtualBox\VBoxGuestAdditions.iso"
vboxmanage storageattach $vmnaam --storagectl "SATA Controller" --port 2 --device 0 --type hdd --medium $medium

vboxmanage modifyvm $vmnaam --boot1 disk --boot2 dvd 

vboxmanage startvm $vmnaam

Read-Host "Druk op enter om de omgeving op te zetten wanneer de VM is opgestart"

$vmUsername = "osboxes"
$vmPassword = "osboxes.org"
$vmDirectory = "/home/osboxes/"

vboxmanage guestcontrol $vmnaam copyto $localPath --target-directory $vmDirectory --username $vmUsername --password $vmPassword
Start-Sleep -Seconds 2
vboxmanage guestcontrol $vmnaam run --exe "/bin/bash" --username $vmUsername --password $vmPassword --wait-stdout --wait-stderr --unquoted-args -- "-c" "chmod +x /home/osboxes/script2.sh && echo osboxes.org | sudo -S /home/osboxes/script2.sh"

# vboxmanage guestcontrol $vmnaam run --exe "/bin/bash" --username $vmUsername --password $vmPassword --wait-stdout --wait-stderr --unquoted-args -- "-c" "chmod +x /home/osboxes/script2.sh"
# vboxmanage guestcontrol $vmnaam run --exe "/bin/bash" --username $vmUsername --password $vmPassword --wait-stdout --wait-stderr --unquoted-args -- "-c" "echo osboxes.org | sudo -S /home/osboxes/script2.sh"
