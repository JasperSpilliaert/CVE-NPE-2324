$vmnaam = "CSV-Kali-Test"
$userChoice = Read-Host "Kies de gebruiker voor de VM setup (Kies '1' voor Jasper, '2' voor Quinten, '3' voor Jorik, '4' voor een custom path)"
switch ($userChoice) {
    "1" {
        $userName = "Jasper"
        $vmpath ="C:\Users\peter\OneDrive\Bureaublad\Kali_VM\64bit\Kali Linux 2023.4 (64bit).vdi"
        $medium = "C:\Users\peter\VirtualBox VMs\$vmnaam\$vmnaam.vdi"
        $bridged_adapter_name = "Realtek RTL8822CE 802.11ac PCIe Adapter"
    }
    "2" {
        $userName = "Quinten"
        $vmpath = "C:\Users\quint\OneDrive - Breugelmans\Bureaublad\School 2023-2024\Semester 2\Cybersecurity & Virtualisation\Kali Linux 2024.1 (64bit).vdi"
        $medium = "C:\Users\quint\VirtualBox VMs\$vmnaam\$vmnaam.vdi"
        $bridged_adapter_name = "Intel(R) Wi-Fi 6E AX210 160MHz"
    }
    "3" {
        $userName = "Jorik"
        $vmpath = "C:\HoGent\2deJaar\cybersecv\git\Kali Linux 2024.1 (64bit).vdi"
        $medium = "C:\Users\braet\VirtualBox VM\$vmnaam\$vmnaam.vdi"
        $bridged_adapter_name = "Realtek Gaming GbE Family Controller"
    }
    "4" {
        $userName = "Custom User"
        $vmpath = Read-Host "Geef het volledige pad naar de Kali VDI file"
        $medium = Read-Host "Geef het volledige pad naar je virtuele hard disk (f.e. C:\Users\peter\VirtualBox VMs\$vmnaam\$vmnaam.vdi)"
        $bridged_adapter_name = Read-Host "Geef de naam van je Bridged Adapter"
    }
    default {
        Write-Host "Ongeldige selectie, exiting..."
        exit
    }
}

$ostype = "Debian_64"
$mem = 2048
$vram = 128
$cpus = 2
$netwerkadapter1 = "bridged"
$drivesize1 = 20000
$controller = "IntelAHCI"

if (!(Test-Path $vmpath)) {
    Write-Host "$vmpath niet gevonden. Controleer het pad naar het VDI-bestand."
    return
}

# Aanmaken Kali VM
vboxmanage createvm --name "$vmnaam" --ostype $ostype --register

# VM specificaties instellen
vboxmanage modifyvm $vmnaam --memory $mem --vram $vram --cpus $cpus --boot1=disk
vboxmanage modifyvm $vmnaam --nic1 $netwerkadapter1 --bridgeadapter1 $bridged_adapter_name

# Virtuele schijf aanmaken
vboxmanage createmedium --filename $medium --size $drivesize1

# Storage controllers en mediums configureren
vboxmanage storagectl $vmnaam --name "SATA Controller" --add sata --controller $controller
vboxmanage storageattach $vmnaam --storagectl "SATA Controller" --port 1 --device 0 --type hdd --medium $vmpath

# Boot volgorde instellen
vboxmanage modifyvm $vmnaam --boot1 disk

# Opstarten Kali VM
vboxmanage startvm $vmnaam
